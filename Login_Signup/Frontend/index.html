<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookNest - Login</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    html, body { 
      height: 100%; 
      overflow: hidden;
    }
    
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      position: relative;
    }

    /* Full-screen background */
    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('background.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: 0;
    }

    /* Darker overlay for better contrast */
    /* .background::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.5) 0%, rgba(40, 25, 15, 0.6) 100%);
      z-index: 1;
    } */

    /* Quote on left side */
    .quote-section {
      position: fixed;
      bottom: 80px;
      left: 60px;
      z-index: 10;
      max-width: 450px;
    }

    .quote-section .quote {
      font-size: 42px;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 8px 24px rgba(0,0,0,0.8);
      line-height: 1.2;
    }

    /* Login card - positioned on right side */
    .login-container {
      position: fixed;
      top: 50%;
      right: 120px;
      transform: translateY(-50%);
      width: 450px;
      z-index: 50;
    }

    .login-card {
      background: rgba(30, 30, 35, 0.75);
      border-radius: 24px;
      padding: 40px 35px;
      backdrop-filter: blur(30px) saturate(150%);
      -webkit-backdrop-filter: blur(30px) saturate(150%);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: 0 24px 48px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05) inset;
      max-height: 90vh;
      overflow-y: auto;
    }

    /* Custom scrollbar for login card */
    .login-card::-webkit-scrollbar {
      width: 6px;
    }

    .login-card::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
    }

    .login-card::-webkit-scrollbar-thumb {
      background: rgba(169, 107, 71, 0.7);
      border-radius: 3px;
    }

    .login-header { 
      margin-bottom: 30px; 
    }
    
    .login-header h1 {
      color: #fff;
      font-size: 36px;
      margin-bottom: 8px;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    .login-header p {
      color: rgba(255,255,255,0.85);
      font-size: 15px;
    }

    .form-group { 
      margin-bottom: 20px; 
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      color: rgba(255,255,255,0.95);
      font-weight: 500;
      font-size: 14px;
    }

    .input-wrapper {
      position: relative;
    }

    .input-wrapper .icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.7);
      font-size: 16px;
      z-index: 2;
    }

    .input-wrapper input {
      width: 100%;
      padding: 14px 16px 14px 48px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(20, 20, 25, 0.6);
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .input-wrapper input::placeholder {
      color: rgba(255,255,255,0.5);
    }
    
    .input-wrapper input:focus {
      box-shadow: 0 0 0 3px rgba(169, 107, 71, 0.4);
      border-color: rgba(169, 107, 71, 0.7);
      background: rgba(30, 30, 35, 0.8);
    }

    /* OTP input styling */
    .otp-input {
      text-align: center;
      letter-spacing: 10px;
      font-size: 22px;
      font-weight: bold;
    }

    /* Password field with eye icon */
    .password-field {
      position: relative;
    }

    .password-field .toggle-password {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.7);
      cursor: pointer;
      font-size: 16px;
      z-index: 3;
      transition: color 0.3s ease;
    }

    .password-field .toggle-password:hover {
      color: rgba(255,255,255,0.95);
    }

    /* Mobile number input with country code */
    .mobile-input-wrapper {
      display: flex;
      gap: 10px;
    }

    .country-code {
      width: 100px;
      flex-shrink: 0;
      position: relative;
    }

    .country-code select {
      width: 100%;
      padding: 12px 8px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(20, 20, 25, 0.6);
      color: #fff;
      font-size: 13px;
      outline: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      appearance: none;
      cursor: pointer;
    }

    .country-code select:focus {
      box-shadow: 0 0 0 3px rgba(169, 107, 71, 0.4);
      border-color: rgba(169, 107, 71, 0.7);
      background: rgba(30, 30, 35, 0.8);
    }

    .country-code::after {
      content: "\f107";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255,255,255,0.7);
      pointer-events: none;
    }

    .mobile-number {
      flex: 1;
    }

    .mobile-number input {
      padding-left: 48px;
    }

    .forgot-row {
      display: flex;
      justify-content: space-between;
      margin: 20px 0 25px;
      font-size: 14px;
    }

    .forgot-link, .verify-email-link {
      color: rgba(255,255,255,0.95);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .forgot-link:hover, .verify-email-link:hover {
      color: #d4a574;
    }

    .login-btn, .signup-btn, .forgot-btn, .verify-btn {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #a96b47 0%, #8b5e3c 100%);
      color: #fff;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 16px rgba(139, 94, 60, 0.4);
    }
    
    .login-btn:hover, .signup-btn:hover, .forgot-btn:hover, .verify-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(139, 94, 60, 0.5);
      background: linear-gradient(135deg, #ba7a52 0%, #9a6a47 100%);
    }

    .login-btn:active, .signup-btn:active, .forgot-btn:active, .verify-btn:active {
      transform: translateY(0);
    }

    .toggle-link {
      margin-top: 20px;
      text-align: center;
      color: rgba(255,255,255,0.9);
      font-size: 14px;
    }
    
    .toggle-link a {
      color: #d4a574;
      font-weight: 600;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .toggle-link a:hover {
      color: #f0c89a;
      text-decoration: underline;
    }

    /* Hidden forms */
    .signup-form, .forgot-password-form, .signup-otp-form, .signup-success-form, .verify-email-form {
      display: none;
    }

    /* Error message */
    .error-message {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    /* Success message */
    .success-message {
      color: #6bff8f;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    /* Info message */
    .info-message {
      color: #6bd2ff;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    /* Password strength indicator */
    .password-strength {
      margin-top: 6px;
      height: 5px;
      border-radius: 3px;
      background: rgba(255,255,255,0.2);
      overflow: hidden;
    }

    .password-strength-bar {
      height: 100%;
      width: 0%;
      transition: all 0.3s ease;
    }

    .strength-weak {
      background: #ff6b6b;
      width: 25%;
    }

    .strength-medium {
      background: #ffb74d;
      width: 50%;
    }

    .strength-strong {
      background: #6bff8f;
      width: 100%;
    }

    /* Resend OTP link */
    .resend-otp {
      text-align: center;
      margin-top: 14px;
      font-size: 13px;
    }

    .resend-otp a {
      color: #d4a574;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .resend-otp a:hover:not(.disabled) {
      color: #f0c89a;
      text-decoration: underline;
    }

    .resend-otp a.disabled {
      color: rgba(255,255,255,0.4);
      cursor: not-allowed;
    }

    /* Progress indicator */
    .progress-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      position: relative;
    }

    .progress-indicator::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: rgba(255,255,255,0.2);
      transform: translateY(-50%);
      z-index: 1;
    }

    .progress-step {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(255,255,255,0.7);
      font-size: 11px;
      font-weight: bold;
      position: relative;
      z-index: 2;
    }

    .progress-step.active {
      background: #a96b47;
      color: #fff;
    }

    .progress-step.completed {
      background: #4CAF50;
      color: #fff;
    }

    .progress-label {
      position: absolute;
      top: 32px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: rgba(255,255,255,0.7);
      white-space: nowrap;
    }

    /* Success screen */
    .success-screen {
      text-align: center;
      padding: 15px 0;
    }

    .success-icon {
      font-size: 48px;
      color: #4CAF50;
      margin-bottom: 14px;
    }

    .success-message-large {
      font-size: 20px;
      color: #fff;
      margin-bottom: 14px;
    }

    .redirect-timer {
      font-size: 13px;
      color: rgba(255,255,255,0.8);
      margin-top: 12px;
    }

    /* Cooldown message */
    .cooldown-message {
      color: #ffb74d;
      font-size: 13px;
      margin-top: 6px;
      display: none;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .login-container {
        right: 60px;
      }
    }

    @media (max-width: 980px) {
      .login-container {
        right: 50%;
        transform: translate(50%, -50%);
        width: 420px;
      }

      .quote-section {
        left: 40px;
        bottom: 60px;
      }

      .quote-section .quote {
        font-size: 32px;
      }
    }

    @media (max-width: 640px) {
      .login-container {
        width: calc(100% - 40px);
        padding: 0 20px;
      }

      .login-card {
        padding: 28px 20px;
      }

      .login-header h1 {
        font-size: 32px;
      }

      .quote-section {
        display: none;
      }
      
      .mobile-input-wrapper {
        flex-direction: column;
      }
      
      .country-code {
        width: 100%;
      }
      
      .forgot-row {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

  <!-- Background -->
  <div class="background"></div>

  <!-- Quote on left -->
  <div class="quote-section">
    <div class="quote">
      "Discover magic<br>in every login."
    </div>
  </div>

  <!-- Login card on right -->
  <div class="login-container">
    <div class="login-card">
      <!-- Login Form -->
      <div class="login-form">
        <div class="login-header">
          <h1>Welcome Back!</h1>
          <p>Login to your account</p>
        </div>

        <form id="loginForm">
          <div class="form-group">
            <label for="loginEmail">Email</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-envelope"></i></span>
              <input id="loginEmail" type="email" placeholder="Enter your email" required>
            </div>
            <div class="error-message" id="loginEmailError"></div>
          </div>

          <div class="form-group password-field">
            <label for="loginPassword">Password</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-lock"></i></span>
              <input id="loginPassword" type="password" placeholder="Password" required>
              <span class="toggle-password" onclick="togglePassword('loginPassword', 'loginEyeIcon')">
                <i class="fas fa-eye-slash" id="loginEyeIcon"></i>
              </span>
            </div>
            <div class="error-message" id="loginPasswordError"></div>
          </div>

          <div class="forgot-row">
            <a href="#" class="forgot-link" id="showForgotPassword">Forgot Password?</a>
            <a href="#" class="verify-email-link" id="showVerifyEmail">Verify Email</a>
          </div>

          <button class="login-btn" type="submit">Login</button>

          <div class="toggle-link">
            Don't have an account? <a href="#" id="showSignup">Sign up</a>
          </div>
        </form>
      </div>

      <!-- Sign Up Form -->
      <div class="signup-form">
        <div class="login-header">
          <h1>Create Account</h1>
          <p>Join the BookNest community</p>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="progress-step active" id="signupStep1">
            1
            <div class="progress-label">Details</div>
          </div>
          <div class="progress-step" id="signupStep2">
            2
            <div class="progress-label">OTP</div>
          </div>
          <div class="progress-step" id="signupStep3">
            3
            <div class="progress-label">Verified</div>
          </div>
        </div>

        <!-- Step 1: User Details -->
        <form id="signupDetailsForm" class="signup-step">
          <div class="form-group">
            <label for="signupUsername">Username</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-user"></i></span>
              <input id="signupUsername" type="text" placeholder="Choose a username" required>
            </div>
            <div class="error-message" id="signupUsernameError"></div>
          </div>

          <div class="form-group">
            <label for="signupEmail">Email</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-envelope"></i></span>
              <input id="signupEmail" type="email" placeholder="Enter your email" required>
            </div>
            <div class="error-message" id="signupEmailError"></div>
          </div>

          <!-- Mobile Number Field -->
          <div class="form-group">
            <label for="signupMobile">Mobile Number</label>
            <div class="mobile-input-wrapper">
              <div class="country-code">
                <select id="countryCode">
                  <!-- Country codes will be populated by JavaScript -->
                </select>
              </div>
              <div class="mobile-number">
                <div class="input-wrapper">
                  <span class="icon"><i class="fas fa-phone"></i></span>
                  <input id="signupMobile" type="tel" placeholder="Enter your mobile number" required>
                </div>
              </div>
            </div>
            <div class="error-message" id="signupMobileError"></div>
          </div>

          <div class="form-group password-field">
            <label for="signupPassword">Password</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-lock"></i></span>
              <input id="signupPassword" type="password" placeholder="Create a password" required onkeyup="checkPasswordStrength()">
              <span class="toggle-password" onclick="togglePassword('signupPassword', 'signupEyeIcon')">
                <i class="fas fa-eye-slash" id="signupEyeIcon"></i>
              </span>
            </div>
            <div class="password-strength">
              <div class="password-strength-bar" id="passwordStrengthBar"></div>
            </div>
            <div class="error-message" id="signupPasswordError"></div>
          </div>

          <button class="signup-btn" type="submit">Send OTP</button>

          <div class="toggle-link">
            Already have an account? <a href="#" id="showLoginFromSignup">Login</a>
          </div>
        </form>

        <!-- Step 2: OTP Verification -->
        <form id="signupOtpForm" class="signup-step" style="display: none;">
          <div class="form-group">
            <label for="signupOtp">Enter OTP</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-key"></i></span>
              <input id="signupOtp" type="text" placeholder="Enter 6-digit OTP" class="otp-input" maxlength="6" required>
            </div>
            <div class="error-message" id="signupOtpError"></div>
            <div class="cooldown-message" id="signupOtpCooldown"></div>
          </div>

          <div class="resend-otp">
            Didn't receive the code? <a href="#" id="resendSignupOtp">Resend OTP</a>
          </div>

          <button class="verify-btn" type="submit">Verify OTP</button>

          <div class="toggle-link">
            <a href="#" id="backToSignupDetails">Back to Details</a>
          </div>
        </form>

        <!-- Step 3: Success Screen -->
        <div id="signupSuccessForm" class="signup-step" style="display: none;">
          <div class="success-screen">
            <div class="success-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="success-message-large">
              Account Verified Successfully!
            </div>
            <p>Your account has been created and verified. You will be redirected to the login page shortly.</p>
            <div class="redirect-timer" id="redirectTimer">
              Redirecting in 7 seconds...
            </div>
          </div>
        </div>
      </div>

      <!-- Forgot Password Form -->
      <div class="forgot-password-form">
        <div class="login-header">
          <h1>Reset Password</h1>
          <p>Follow the steps to reset your password</p>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="progress-step active" id="forgotStep1">
            1
            <div class="progress-label">Email</div>
          </div>
          <div class="progress-step" id="forgotStep2">
            2
            <div class="progress-label">OTP</div>
          </div>
          <div class="progress-step" id="forgotStep3">
            3
            <div class="progress-label">New Password</div>
          </div>
        </div>

        <!-- Step 1: Email Entry -->
        <form id="forgotEmailForm" class="forgot-step">
          <div class="form-group">
            <label for="forgotEmail">Enter your email</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-envelope"></i></span>
              <input id="forgotEmail" type="email" placeholder="Enter your email address" required>
            </div>
            <div class="error-message" id="forgotEmailError"></div>
            <div class="success-message" id="forgotEmailSuccess"></div>
          </div>

          <button class="forgot-btn" type="submit">Send OTP</button>

          <div class="toggle-link">
            Remember your password? <a href="#" id="backToLoginFromForgot">Back to Login</a>
          </div>
        </form>

        <!-- Step 2: OTP Verification -->
        <form id="forgotOtpForm" class="forgot-step" style="display: none;">
          <div class="form-group">
            <label for="forgotOtp">Enter OTP</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-key"></i></span>
              <input id="forgotOtp" type="text" placeholder="Enter 6-digit OTP" class="otp-input" maxlength="6" required>
            </div>
            <div class="error-message" id="forgotOtpError"></div>
            <div class="success-message" id="forgotOtpSuccess"></div>
          </div>

          <div class="resend-otp">
            Didn't receive the code? <a href="#" id="resendOtp">Resend OTP</a>
          </div>

          <button class="forgot-btn" type="submit">Verify OTP</button>

          <div class="toggle-link">
            <a href="#" id="backToEmailStep">Back to Email</a>
          </div>
        </form>

        <!-- Step 3: New Password -->
        <form id="forgotNewPasswordForm" class="forgot-step" style="display: none;">
          <div class="form-group password-field">
            <label for="forgotNewPassword">New Password</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-lock"></i></span>
              <input id="forgotNewPassword" type="password" placeholder="Enter new password" required onkeyup="checkForgotPasswordStrength()">
              <span class="toggle-password" onclick="togglePassword('forgotNewPassword', 'forgotNewEyeIcon')">
                <i class="fas fa-eye-slash" id="forgotNewEyeIcon"></i>
              </span>
            </div>
            <div class="password-strength">
              <div class="password-strength-bar" id="forgotPasswordStrengthBar"></div>
            </div>
            <div class="error-message" id="forgotNewPasswordError"></div>
          </div>

          <div class="form-group password-field">
            <label for="forgotConfirmPassword">Confirm New Password</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-lock"></i></span>
              <input id="forgotConfirmPassword" type="password" placeholder="Confirm new password" required>
              <span class="toggle-password" onclick="togglePassword('forgotConfirmPassword', 'forgotConfirmEyeIcon')">
                <i class="fas fa-eye-slash" id="forgotConfirmEyeIcon"></i>
              </span>
            </div>
            <div class="error-message" id="forgotConfirmPasswordError"></div>
          </div>

          <button class="forgot-btn" type="submit">Reset Password</button>

          <div class="toggle-link">
            <a href="#" id="backToOtpStep">Back to OTP</a>
          </div>
        </form>
      </div>

      <!-- NEW: Verify Email Form -->
      <div class="verify-email-form">
        <div class="login-header">
          <h1>Verify Email</h1>
          <p>Verify your email address to complete registration</p>
        </div>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
          <div class="progress-step active" id="verifyEmailStep1">
            1
            <div class="progress-label">Credentials</div>
          </div>
          <div class="progress-step" id="verifyEmailStep2">
            2
            <div class="progress-label">OTP</div>
          </div>
          <div class="progress-step" id="verifyEmailStep3">
            3
            <div class="progress-label">Result</div>
          </div>
        </div>

        <!-- Step 1: Email and Password Entry -->
        <form id="verifyEmailRequestForm" class="verify-email-step">
          <div class="form-group">
            <label for="verifyEmail">Email</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-envelope"></i></span>
              <input id="verifyEmail" type="email" placeholder="Enter your registered email" required>
            </div>
            <div class="error-message" id="verifyEmailError"></div>
          </div>

          <div class="form-group password-field">
            <label for="verifyPassword">Password</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-lock"></i></span>
              <input id="verifyPassword" type="password" placeholder="Enter your password" required>
              <span class="toggle-password" onclick="togglePassword('verifyPassword', 'verifyEyeIcon')">
                <i class="fas fa-eye-slash" id="verifyEyeIcon"></i>
              </span>
            </div>
            <div class="error-message" id="verifyPasswordError"></div>
          </div>

          <button class="verify-btn" type="submit">Verify Account</button>

          <div class="toggle-link">
            <a href="#" id="backToLoginFromVerify">Back to Login</a>
          </div>
        </form>

        <!-- Step 2: OTP Verification -->
        <form id="verifyEmailOtpForm" class="verify-email-step" style="display: none;">
          <div class="form-group">
            <label for="verifyEmailOtp">Enter OTP</label>
            <div class="input-wrapper">
              <span class="icon"><i class="fas fa-key"></i></span>
              <input id="verifyEmailOtp" type="text" placeholder="Enter 6-digit OTP" class="otp-input" maxlength="6" required>
            </div>
            <div class="error-message" id="verifyEmailOtpError"></div>
            <div class="success-message" id="verifyEmailOtpSuccess"></div>
            <div class="info-message" id="verifyEmailOtpInfo"></div>
          </div>

          <div class="resend-otp">
            Didn't receive the code? <a href="#" id="resendVerifyEmailOtp">Resend OTP</a>
          </div>

          <button class="verify-btn" type="submit">Verify OTP</button>

          <div class="toggle-link">
            <a href="#" id="backToVerifyEmailRequest">Back to Email</a>
          </div>
        </form>

        <!-- Step 3: Result Screen -->
        <div id="verifyEmailResultForm" class="verify-email-step" style="display: none;">
          <div class="success-screen">
            <div class="success-icon" id="verifyEmailResultIcon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="success-message-large" id="verifyEmailResultMessage">
              Email Verified Successfully!
            </div>
            <p id="verifyEmailResultDescription">Your email has been verified successfully. You can now login to your account.</p>
            <div class="redirect-timer" id="verifyEmailRedirectTimer">
              Redirecting to login in 7 seconds...
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // API Configuration
  const API_BASE_URL = 'http://localhost:3000/api/auth';
  
  // Global variables
  let signupOtpAttempts = 0;
  let signupCooldownActive = false;
  let signupCooldownTime = 30;
  let signupData = {};
  let forgotPasswordEmail = '';
  let forgotPasswordOtp = '';
  let redirectTimer;
  
  // New variable for email verification
  let verifyEmailData = {};

  // ==================== COUNTRY CODES ====================
  
  // Comprehensive list of country codes including Pakistan
  const countryCodes = [
    { code: '+93', name: 'Afghanistan (AF)' },
    { code: '+355', name: 'Albania (AL)' },
    { code: '+213', name: 'Algeria (DZ)' },
    { code: '+376', name: 'Andorra (AD)' },
    { code: '+244', name: 'Angola (AO)' },
    { code: '+1-268', name: 'Antigua and Barbuda (AG)' },
    { code: '+54', name: 'Argentina (AR)' },
    { code: '+374', name: 'Armenia (AM)' },
    { code: '+297', name: 'Aruba (AW)' },
    { code: '+61', name: 'Australia (AU)' },
    { code: '+43', name: 'Austria (AT)' },
    { code: '+994', name: 'Azerbaijan (AZ)' },
    { code: '+1-242', name: 'Bahamas (BS)' },
    { code: '+973', name: 'Bahrain (BH)' },
    { code: '+880', name: 'Bangladesh (BD)' },
    { code: '+1-246', name: 'Barbados (BB)' },
    { code: '+375', name: 'Belarus (BY)' },
    { code: '+32', name: 'Belgium (BE)' },
    { code: '+501', name: 'Belize (BZ)' },
    { code: '+229', name: 'Benin (BJ)' },
    { code: '+1-441', name: 'Bermuda (BM)' },
    { code: '+975', name: 'Bhutan (BT)' },
    { code: '+591', name: 'Bolivia (BO)' },
    { code: '+387', name: 'Bosnia and Herzegovina (BA)' },
    { code: '+267', name: 'Botswana (BW)' },
    { code: '+55', name: 'Brazil (BR)' },
    { code: '+246', name: 'British Indian Ocean Territory (IO)' },
    { code: '+1-284', name: 'British Virgin Islands (VG)' },
    { code: '+673', name: 'Brunei (BN)' },
    { code: '+359', name: 'Bulgaria (BG)' },
    { code: '+226', name: 'Burkina Faso (BF)' },
    { code: '+257', name: 'Burundi (BI)' },
    { code: '+855', name: 'Cambodia (KH)' },
    { code: '+237', name: 'Cameroon (CM)' },
    { code: '+1', name: 'Canada (CA)' },
    { code: '+238', name: 'Cape Verde (CV)' },
    { code: '+1-345', name: 'Cayman Islands (KY)' },
    { code: '+236', name: 'Central African Republic (CF)' },
    { code: '+235', name: 'Chad (TD)' },
    { code: '+56', name: 'Chile (CL)' },
    { code: '+86', name: 'China (CN)' },
    { code: '+61', name: 'Christmas Island (CX)' },
    { code: '+61', name: 'Cocos Islands (CC)' },
    { code: '+57', name: 'Colombia (CO)' },
    { code: '+269', name: 'Comoros (KM)' },
    { code: '+682', name: 'Cook Islands (CK)' },
    { code: '+506', name: 'Costa Rica (CR)' },
    { code: '+385', name: 'Croatia (HR)' },
    { code: '+53', name: 'Cuba (CU)' },
    { code: '+599', name: 'Curacao (CW)' },
    { code: '+357', name: 'Cyprus (CY)' },
    { code: '+420', name: 'Czech Republic (CZ)' },
    { code: '+243', name: 'Democratic Republic of the Congo (CD)' },
    { code: '+45', name: 'Denmark (DK)' },
    { code: '+253', name: 'Djibouti (DJ)' },
    { code: '+1-767', name: 'Dominica (DM)' },
    { code: '+1-809', name: 'Dominican Republic (DO)' },
    { code: '+670', name: 'East Timor (TL)' },
    { code: '+593', name: 'Ecuador (EC)' },
    { code: '+20', name: 'Egypt (EG)' },
    { code: '+503', name: 'El Salvador (SV)' },
    { code: '+240', name: 'Equatorial Guinea (GQ)' },
    { code: '+291', name: 'Eritrea (ER)' },
    { code: '+372', name: 'Estonia (EE)' },
    { code: '+251', name: 'Ethiopia (ET)' },
    { code: '+500', name: 'Falkland Islands (FK)' },
    { code: '+298', name: 'Faroe Islands (FO)' },
    { code: '+679', name: 'Fiji (FJ)' },
    { code: '+358', name: 'Finland (FI)' },
    { code: '+33', name: 'France (FR)' },
    { code: '+689', name: 'French Polynesia (PF)' },
    { code: '+241', name: 'Gabon (GA)' },
    { code: '+220', name: 'Gambia (GM)' },
    { code: '+995', name: 'Georgia (GE)' },
    { code: '+49', name: 'Germany (DE)' },
    { code: '+233', name: 'Ghana (GH)' },
    { code: '+350', name: 'Gibraltar (GI)' },
    { code: '+30', name: 'Greece (GR)' },
    { code: '+299', name: 'Greenland (GL)' },
    { code: '+1-473', name: 'Grenada (GD)' },
    { code: '+1-671', name: 'Guam (GU)' },
    { code: '+502', name: 'Guatemala (GT)' },
    { code: '+44-1481', name: 'Guernsey (GG)' },
    { code: '+224', name: 'Guinea (GN)' },
    { code: '+245', name: 'Guinea-Bissau (GW)' },
    { code: '+592', name: 'Guyana (GY)' },
    { code: '+509', name: 'Haiti (HT)' },
    { code: '+504', name: 'Honduras (HN)' },
    { code: '+852', name: 'Hong Kong (HK)' },
    { code: '+36', name: 'Hungary (HU)' },
    { code: '+354', name: 'Iceland (IS)' },
    { code: '+91', name: 'India (IN)' },
    { code: '+62', name: 'Indonesia (ID)' },
    { code: '+98', name: 'Iran (IR)' },
    { code: '+964', name: 'Iraq (IQ)' },
    { code: '+353', name: 'Ireland (IE)' },
    { code: '+44-1624', name: 'Isle of Man (IM)' },
    { code: '+39', name: 'Italy (IT)' },
    { code: '+225', name: 'Ivory Coast (CI)' },
    { code: '+1-876', name: 'Jamaica (JM)' },
    { code: '+81', name: 'Japan (JP)' },
    { code: '+44-1534', name: 'Jersey (JE)' },
    { code: '+962', name: 'Jordan (JO)' },
    { code: '+7', name: 'Kazakhstan (KZ)' },
    { code: '+254', name: 'Kenya (KE)' },
    { code: '+686', name: 'Kiribati (KI)' },
    { code: '+383', name: 'Kosovo (XK)' },
    { code: '+965', name: 'Kuwait (KW)' },
    { code: '+996', name: 'Kyrgyzstan (KG)' },
    { code: '+856', name: 'Laos (LA)' },
    { code: '+371', name: 'Latvia (LV)' },
    { code: '+961', name: 'Lebanon (LB)' },
    { code: '+266', name: 'Lesotho (LS)' },
    { code: '+231', name: 'Liberia (LR)' },
    { code: '+218', name: 'Libya (LY)' },
    { code: '+423', name: 'Liechtenstein (LI)' },
    { code: '+370', name: 'Lithuania (LT)' },
    { code: '+352', name: 'Luxembourg (LU)' },
    { code: '+853', name: 'Macau (MO)' },
    { code: '+389', name: 'Macedonia (MK)' },
    { code: '+261', name: 'Madagascar (MG)' },
    { code: '+265', name: 'Malawi (MW)' },
    { code: '+60', name: 'Malaysia (MY)' },
    { code: '+960', name: 'Maldives (MV)' },
    { code: '+223', name: 'Mali (ML)' },
    { code: '+356', name: 'Malta (MT)' },
    { code: '+692', name: 'Marshall Islands (MH)' },
    { code: '+222', name: 'Mauritania (MR)' },
    { code: '+230', name: 'Mauritius (MU)' },
    { code: '+262', name: 'Mayotte (YT)' },
    { code: '+52', name: 'Mexico (MX)' },
    { code: '+691', name: 'Micronesia (FM)' },
    { code: '+373', name: 'Moldova (MD)' },
    { code: '+377', name: 'Monaco (MC)' },
    { code: '+976', name: 'Mongolia (MN)' },
    { code: '+382', name: 'Montenegro (ME)' },
    { code: '+1-664', name: 'Montserrat (MS)' },
    { code: '+212', name: 'Morocco (MA)' },
    { code: '+258', name: 'Mozambique (MZ)' },
    { code: '+95', name: 'Myanmar (MM)' },
    { code: '+264', name: 'Namibia (NA)' },
    { code: '+674', name: 'Nauru (NR)' },
    { code: '+977', name: 'Nepal (NP)' },
    { code: '+31', name: 'Netherlands (NL)' },
    { code: '+599', name: 'Netherlands Antilles (AN)' },
    { code: '+687', name: 'New Caledonia (NC)' },
    { code: '+64', name: 'New Zealand (NZ)' },
    { code: '+505', name: 'Nicaragua (NI)' },
    { code: '+227', name: 'Niger (NE)' },
    { code: '+234', name: 'Nigeria (NG)' },
    { code: '+683', name: 'Niue (NU)' },
    { code: '+850', name: 'North Korea (KP)' },
    { code: '+1-670', name: 'Northern Mariana Islands (MP)' },
    { code: '+47', name: 'Norway (NO)' },
    { code: '+968', name: 'Oman (OM)' },
    { code: '+92', name: 'Pakistan (PK)' },
    { code: '+680', name: 'Palau (PW)' },
    { code: '+970', name: 'Palestine (PS)' },
    { code: '+507', name: 'Panama (PA)' },
    { code: '+675', name: 'Papua New Guinea (PG)' },
    { code: '+595', name: 'Paraguay (PY)' },
    { code: '+51', name: 'Peru (PE)' },
    { code: '+63', name: 'Philippines (PH)' },
    { code: '+64', name: 'Pitcairn (PN)' },
    { code: '+48', name: 'Poland (PL)' },
    { code: '+351', name: 'Portugal (PT)' },
    { code: '+1-787', name: 'Puerto Rico (PR)' },
    { code: '+974', name: 'Qatar (QA)' },
    { code: '+242', name: 'Republic of the Congo (CG)' },
    { code: '+262', name: 'Reunion (RE)' },
    { code: '+40', name: 'Romania (RO)' },
    { code: '+7', name: 'Russia (RU)' },
    { code: '+250', name: 'Rwanda (RW)' },
    { code: '+590', name: 'Saint Barthelemy (BL)' },
    { code: '+290', name: 'Saint Helena (SH)' },
    { code: '+1-869', name: 'Saint Kitts and Nevis (KN)' },
    { code: '+1-758', name: 'Saint Lucia (LC)' },
    { code: '+590', name: 'Saint Martin (MF)' },
    { code: '+508', name: 'Saint Pierre and Miquelon (PM)' },
    { code: '+1-784', name: 'Saint Vincent and the Grenadines (VC)' },
    { code: '+685', name: 'Samoa (WS)' },
    { code: '+378', name: 'San Marino (SM)' },
    { code: '+239', name: 'Sao Tome and Principe (ST)' },
    { code: '+966', name: 'Saudi Arabia (SA)' },
    { code: '+221', name: 'Senegal (SN)' },
    { code: '+381', name: 'Serbia (RS)' },
    { code: '+248', name: 'Seychelles (SC)' },
    { code: '+232', name: 'Sierra Leone (SL)' },
    { code: '+65', name: 'Singapore (SG)' },
    { code: '+1-721', name: 'Sint Maarten (SX)' },
    { code: '+421', name: 'Slovakia (SK)' },
    { code: '+386', name: 'Slovenia (SI)' },
    { code: '+677', name: 'Solomon Islands (SB)' },
    { code: '+252', name: 'Somalia (SO)' },
    { code: '+27', name: 'South Africa (ZA)' },
    { code: '+82', name: 'South Korea (KR)' },
    { code: '+211', name: 'South Sudan (SS)' },
    { code: '+34', name: 'Spain (ES)' },
    { code: '+94', name: 'Sri Lanka (LK)' },
    { code: '+249', name: 'Sudan (SD)' },
    { code: '+597', name: 'Suriname (SR)' },
    { code: '+47', name: 'Svalbard and Jan Mayen (SJ)' },
    { code: '+268', name: 'Swaziland (SZ)' },
    { code: '+46', name: 'Sweden (SE)' },
    { code: '+41', name: 'Switzerland (CH)' },
    { code: '+963', name: 'Syria (SY)' },
    { code: '+886', name: 'Taiwan (TW)' },
    { code: '+992', name: 'Tajikistan (TJ)' },
    { code: '+255', name: 'Tanzania (TZ)' },
    { code: '+66', name: 'Thailand (TH)' },
    { code: '+228', name: 'Togo (TG)' },
    { code: '+690', name: 'Tokelau (TK)' },
    { code: '+676', name: 'Tonga (TO)' },
    { code: '+1-868', name: 'Trinidad and Tobago (TT)' },
    { code: '+216', name: 'Tunisia (TN)' },
    { code: '+90', name: 'Turkey (TR)' },
    { code: '+993', name: 'Turkmenistan (TM)' },
    { code: '+1-649', name: 'Turks and Caicos Islands (TC)' },
    { code: '+688', name: 'Tuvalu (TV)' },
    { code: '+1-340', name: 'U.S. Virgin Islands (VI)' },
    { code: '+256', name: 'Uganda (UG)' },
    { code: '+380', name: 'Ukraine (UA)' },
    { code: '+971', name: 'United Arab Emirates (AE)' },
    { code: '+44', name: 'United Kingdom (GB)' },
    { code: '+1', name: 'United States (US)' },
    { code: '+598', name: 'Uruguay (UY)' },
    { code: '+998', name: 'Uzbekistan (UZ)' },
    { code: '+678', name: 'Vanuatu (VU)' },
    { code: '+379', name: 'Vatican (VA)' },
    { code: '+58', name: 'Venezuela (VE)' },
    { code: '+84', name: 'Vietnam (VN)' },
    { code: '+681', name: 'Wallis and Futuna (WF)' },
    { code: '+212', name: 'Western Sahara (EH)' },
    { code: '+967', name: 'Yemen (YE)' },
    { code: '+260', name: 'Zambia (ZM)' },
    { code: '+263', name: 'Zimbabwe (ZW)' }
  ];

  // Function to populate country codes dropdown
  function populateCountryCodes() {
    const countryCodeSelect = document.getElementById('countryCode');
    
    // Sort countries alphabetically by name
    countryCodes.sort((a, b) => a.name.localeCompare(b.name));
    
    // Add options to select
    countryCodes.forEach(country => {
      const option = document.createElement('option');
      option.value = country.code;
      option.textContent = `${country.code} - ${country.name}`;
      countryCodeSelect.appendChild(option);
    });
    
    // Set default to Pakistan
    const pakistanOption = countryCodes.find(country => country.name.includes('Pakistan'));
    if (pakistanOption) {
      countryCodeSelect.value = pakistanOption.code;
    }
  }

  // ==================== DEBUG & INITIALIZATION ====================
  
  console.log('ðŸ”§ Script loaded - testing form connections');

  // ==================== UTILITY FUNCTIONS ====================
  
  // API call helper function
  async function apiCall(endpoint, method = 'GET', data = null, requiresAuth = false) {
    const options = {
      method: method,
      headers: {
        'Content-Type': 'application/json'
      }
    };

    if (requiresAuth) {
      const token = localStorage.getItem('token');
      if (token) {
        options.headers['Authorization'] = `Bearer ${token}`;
      }
    }

    if (data && (method === 'POST' || method === 'PUT')) {
      options.body = JSON.stringify(data);
    }

    try {
      const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
      const result = await response.json();
      return { success: response.ok, status: response.status, data: result };
    } catch (error) {
      console.error('API Error:', error);
      return { success: false, error: error.message };
    }
  }

  // Password validation function
  function validatePassword(password) {
    const minLength = 8;
    const hasUpperCase = /[A-Z]/.test(password);
    const hasLowerCase = /[a-z]/.test(password);
    const hasNumbers = /\d/.test(password);
    const hasSpecialChar = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
    
    return password.length >= minLength && 
           hasUpperCase && 
           hasLowerCase && 
           hasNumbers && 
           hasSpecialChar;
  }

  // Username validation function
  function validateUsername(username) {
    const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
    return usernameRegex.test(username);
  }

  // Mobile number validation function
  function validateMobileNumber(mobile) {
    // Remove any non-digit characters
    const cleanedMobile = mobile.replace(/\D/g, '');
    
    // Basic validation - between 8 and 15 digits
    return cleanedMobile.length >= 8 && cleanedMobile.length <= 15;
  }

  // Password strength indicator
  function checkPasswordStrength() {
    const password = document.getElementById('signupPassword').value;
    const strengthBar = document.getElementById('passwordStrengthBar');
    
    strengthBar.className = 'password-strength-bar';
    
    if (password.length === 0) {
      strengthBar.style.width = '0%';
      return;
    }
    
    let strength = 0;
    if (password.length >= 8) strength += 25;
    if (/[A-Z]/.test(password)) strength += 25;
    if (/[a-z]/.test(password)) strength += 25;
    if (/[0-9]/.test(password)) strength += 15;
    if (/[^A-Za-z0-9]/.test(password)) strength += 10;
    
    strength = Math.min(strength, 100);
    strengthBar.style.width = strength + '%';
    
    if (strength < 50) {
      strengthBar.classList.add('strength-weak');
    } else if (strength < 80) {
      strengthBar.classList.add('strength-medium');
    } else {
      strengthBar.classList.add('strength-strong');
    }
  }

  function checkForgotPasswordStrength() {
    const password = document.getElementById('forgotNewPassword').value;
    const strengthBar = document.getElementById('forgotPasswordStrengthBar');
    
    strengthBar.className = 'password-strength-bar';
    
    if (password.length === 0) {
      strengthBar.style.width = '0%';
      return;
    }
    
    let strength = 0;
    if (password.length >= 8) strength += 25;
    if (/[A-Z]/.test(password)) strength += 25;
    if (/[a-z]/.test(password)) strength += 25;
    if (/[0-9]/.test(password)) strength += 15;
    if (/[^A-Za-z0-9]/.test(password)) strength += 10;
    
    strength = Math.min(strength, 100);
    strengthBar.style.width = strength + '%';
    
    if (strength < 50) {
      strengthBar.classList.add('strength-weak');
    } else if (strength < 80) {
      strengthBar.classList.add('strength-medium');
    } else {
      strengthBar.classList.add('strength-strong');
    }
  }

  // Toggle password visibility
  function togglePassword(passwordFieldId, eyeIconId) {
    const passwordInput = document.getElementById(passwordFieldId);
    const eyeIcon = document.getElementById(eyeIconId);
    
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      eyeIcon.classList.remove('fa-eye-slash');
      eyeIcon.classList.add('fa-eye');
    } else {
      passwordInput.type = 'password';
      eyeIcon.classList.remove('fa-eye');
      eyeIcon.classList.add('fa-eye-slash');
    }
  }

  // ==================== LOGIN FUNCTIONALITY ====================
  
  async function handleLoginSubmit(e) {
    e.preventDefault();
    console.log('ðŸ” Login form submitted');
    
    document.getElementById('loginEmailError').style.display = 'none';
    document.getElementById('loginPasswordError').style.display = 'none';
    
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    let isValid = true;
    
    if (!email) {
        document.getElementById('loginEmailError').textContent = 'Email is required';
        document.getElementById('loginEmailError').style.display = 'block';
        isValid = false;
    } else if (!emailRegex.test(email)) {
        document.getElementById('loginEmailError').textContent = 'Please enter a valid email address';
        document.getElementById('loginEmailError').style.display = 'block';
        isValid = false;
    }
    
    if (!password) {
        document.getElementById('loginPasswordError').textContent = 'Password is required';
        document.getElementById('loginPasswordError').style.display = 'block';
        isValid = false;
    }
    
    if (isValid) {
        // Call backend API
        const result = await apiCall('/login', 'POST', { email, password });
        
        if (result.success && result.data.success) {
            // Store token and user data
            localStorage.setItem('token', result.data.token);
            localStorage.setItem('user', JSON.stringify(result.data.user));
            
            // Redirect based on user role
            const userRole = result.data.user.role;
            
            if (userRole === 'admin') {
                console.log('ðŸ‘‘ Admin user detected, redirecting to admin panel');
                alert('Login successful! Redirecting to admin panel...');
                window.location.href = '../../admin features/backend/BookNest_admin.html'; // Adjust path as needed
            } else {
                console.log('ðŸ‘¤ Regular user detected, redirecting to home');
                alert('Login successful! Redirecting to home page...');
                window.location.href = 'home.html';
            }
        } else {
            // Show error message
            const errorMsg = result.data?.message || 'Login failed. Please try again.';
            document.getElementById('loginPasswordError').textContent = errorMsg;
            document.getElementById('loginPasswordError').style.display = 'block';
        }
    }
  }

  // ==================== SIGNUP FUNCTIONALITY ====================
  
  async function handleSignupDetailsSubmit(e) {
    e.preventDefault();
    console.log('ðŸŽ¯ Send OTP button clicked!');
    
    // Get the form element directly by ID
    const form = document.getElementById('signupDetailsForm');
    
    const name = document.getElementById('signupUsername').value.trim();
    const email = document.getElementById('signupEmail').value.trim();
    const countryCode = document.getElementById('countryCode').value;
    const mobile = document.getElementById('signupMobile').value.trim();
    const password = document.getElementById('signupPassword').value;
    
    console.log('Form data:', { name, email, countryCode, mobile, password });
    
    // Clear previous errors
    document.getElementById('signupUsernameError').style.display = 'none';
    document.getElementById('signupEmailError').style.display = 'none';
    document.getElementById('signupMobileError').style.display = 'none';
    document.getElementById('signupPasswordError').style.display = 'none';
    
    let isValid = true;
    
    // Name validation
    if (!name) {
      document.getElementById('signupUsernameError').textContent = 'Name is required';
      document.getElementById('signupUsernameError').style.display = 'block';
      isValid = false;
    } else if (name.length < 2) {
      document.getElementById('signupUsernameError').textContent = 'Name must be at least 2 characters long';
      document.getElementById('signupUsernameError').style.display = 'block';
      isValid = false;
    }
    
    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email) {
      document.getElementById('signupEmailError').textContent = 'Email is required';
      document.getElementById('signupEmailError').style.display = 'block';
      isValid = false;
    } else if (!emailRegex.test(email)) {
      document.getElementById('signupEmailError').textContent = 'Please enter a valid email address';
      document.getElementById('signupEmailError').style.display = 'block';
      isValid = false;
    }
    
    // Mobile validation
    if (!mobile) {
      document.getElementById('signupMobileError').textContent = 'Mobile number is required';
      document.getElementById('signupMobileError').style.display = 'block';
      isValid = false;
    } else if (!validateMobileNumber(mobile)) {
      document.getElementById('signupMobileError').textContent = 'Please enter a valid mobile number (8-15 digits)';
      document.getElementById('signupMobileError').style.display = 'block';
      isValid = false;
    }
    
    // Password validation
    if (!password) {
      document.getElementById('signupPasswordError').textContent = 'Password is required';
      document.getElementById('signupPasswordError').style.display = 'block';
      isValid = false;
    } else if (!validatePassword(password)) {
      document.getElementById('signupPasswordError').textContent = 'Password must be at least 8 characters with uppercase, lowercase, number, and special character';
      document.getElementById('signupPasswordError').style.display = 'block';
      isValid = false;
    }
    
    if (!isValid) return;
    
    try {
      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Sending OTP...';
      submitBtn.disabled = true;
      
      console.log('ðŸ“¡ Calling backend signup API...');
      
      // Format mobile number for backend
      const formattedMobile = countryCode + mobile.replace(/\D/g, '');
      
      // Call backend signup endpoint
      const result = await apiCall('/signup', 'POST', { 
        name, 
        email, 
        mobile: formattedMobile,
        password 
      });
      
      console.log('Backend response:', result);
      
      if (result.success && result.data.success) {
        // Store user data for OTP verification
        signupData = { name, email, mobile: formattedMobile, password };
        
        console.log('âœ… OTP sent successfully! Moving to OTP entry page...');
        
        // SUCCESS: Move to OTP entry page
        showSignupStep(2);
        
      } else {
        // Show backend error message
        const errorMsg = result.data?.message || 'Failed to send OTP. Please try again.';
        console.error('Backend error:', errorMsg);
        
        // Show error in the form
        document.getElementById('signupEmailError').textContent = errorMsg;
        document.getElementById('signupEmailError').style.display = 'block';
      }
      
    } catch (error) {
      console.error('âŒ Network error:', error);
      alert('Network error: ' + error.message);
    } finally {
      // Restore button state
      const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.textContent = 'Send OTP';
      submitBtn.disabled = false;
    }
  }

  async function handleSignupOtpSubmit(e) {
    e.preventDefault();
    console.log('ðŸŽ¯ Verify OTP button clicked!');
    
    if (signupCooldownActive) {
      document.getElementById('signupOtpError').textContent = 'Please wait for the cooldown period to end before trying again';
      document.getElementById('signupOtpError').style.display = 'block';
      return;
    }
    
    const otp = document.getElementById('signupOtp').value.trim();
    
    document.getElementById('signupOtpError').style.display = 'none';
    document.getElementById('signupOtpCooldown').style.display = 'none';
    
    if (!otp) {
      document.getElementById('signupOtpError').textContent = 'OTP is required';
      document.getElementById('signupOtpError').style.display = 'block';
      return;
    }
    
    if (otp.length !== 6 || !/^\d+$/.test(otp)) {
      document.getElementById('signupOtpError').textContent = 'Please enter a valid 6-digit OTP';
      document.getElementById('signupOtpError').style.display = 'block';
      signupOtpAttempts++;
      checkOtpAttempts();
      return;
    }
    
    // Call backend API
    const result = await apiCall('/verify-otp', 'POST', { 
      email: signupData.email, 
      otp: otp 
    });
    
    if (result.success && result.data.success) {
      // OTP verified successfully
      console.log('âœ… OTP verified! Moving to success page');
      showSignupStep(3);
    } else {
      // Show error
      const errorMsg = result.data?.message || 'Invalid OTP. Please try again.';
      document.getElementById('signupOtpError').textContent = errorMsg;
      document.getElementById('signupOtpError').style.display = 'block';
      signupOtpAttempts++;
      checkOtpAttempts();
    }
  }

  async function handleResendSignupOtp(e) {
    e.preventDefault();
    console.log('ðŸ”„ Resend OTP clicked');
    
    if (signupCooldownActive || this.classList.contains('disabled')) {
      return;
    }
    
    // Resend OTP via backend
    const result = await apiCall('/signup', 'POST', { 
      name: signupData.name, 
      email: signupData.email, 
      mobile: signupData.mobile,
      password: signupData.password 
    });
    
    if (result.success && result.data.success) {
      alert('New OTP sent to your email!');
      document.getElementById('signupOtp').value = '';
    } else {
      alert('Failed to resend OTP. Please try again.');
    }
  }

  // ==================== FORGOT PASSWORD FUNCTIONALITY ====================
  
  async function handleForgotEmailSubmit(e) {
    e.preventDefault();
    console.log('ðŸ”‘ Forgot password email submitted');
    
    const email = document.getElementById('forgotEmail').value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    document.getElementById('forgotEmailError').style.display = 'none';
    document.getElementById('forgotEmailSuccess').style.display = 'none';
    
    if (!email) {
      document.getElementById('forgotEmailError').textContent = 'Email is required';
      document.getElementById('forgotEmailError').style.display = 'block';
      return;
    }
    
    if (!emailRegex.test(email)) {
      document.getElementById('forgotEmailError').textContent = 'Please enter a valid email address';
      document.getElementById('forgotEmailError').style.display = 'block';
      return;
    }
    
    // Call backend API
    const result = await apiCall('/forgot-password', 'POST', { email });
    
    if (result.success && result.data.success) {
      forgotPasswordEmail = email;
      document.getElementById('forgotEmailSuccess').textContent = 'OTP sent to your email address';
      document.getElementById('forgotEmailSuccess').style.display = 'block';
      
      setTimeout(() => {
        showForgotStep(2);
      }, 1500);
    } else {
      const errorMsg = result.data?.message || 'Failed to send OTP. Please try again.';
      document.getElementById('forgotEmailError').textContent = errorMsg;
      document.getElementById('forgotEmailError').style.display = 'block';
    }
  }

  async function handleForgotOtpSubmit(e) {
    e.preventDefault();
    console.log('ðŸ”‘ Forgot password OTP submitted');
    
    const otp = document.getElementById('forgotOtp').value.trim();
    
    document.getElementById('forgotOtpError').style.display = 'none';
    document.getElementById('forgotOtpSuccess').style.display = 'none';
    
    if (!otp) {
        document.getElementById('forgotOtpError').textContent = 'OTP is required';
        document.getElementById('forgotOtpError').style.display = 'block';
        return;
    }
    
    if (otp.length !== 6 || !/^\d+$/.test(otp)) {
        document.getElementById('forgotOtpError').textContent = 'Please enter a valid 6-digit OTP';
        document.getElementById('forgotOtpError').style.display = 'block';
        return;
    }
    
    // ========== ADD THIS: Actually verify OTP with backend ==========
    try {
        // Show loading state
        const submitBtn = document.querySelector('#forgotOtpForm button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Verifying...';
        submitBtn.disabled = true;
        
        // Call backend to verify OTP BEFORE moving to next step
        const result = await apiCall('/verify-reset-otp', 'POST', { 
            email: forgotPasswordEmail, 
            otp: otp 
        });
        
        if (result.success && result.data.success) {
            // Store OTP for password reset
            forgotPasswordOtp = otp;
            
            document.getElementById('forgotOtpSuccess').textContent = 'OTP verified successfully';
            document.getElementById('forgotOtpSuccess').style.display = 'block';
            
            setTimeout(() => {
                showForgotStep(3);
            }, 1500);
        } else {
            // Show error from backend
            const errorMsg = result.data?.message || 'Invalid OTP. Please try again.';
            document.getElementById('forgotOtpError').textContent = errorMsg;
            document.getElementById('forgotOtpError').style.display = 'block';
        }
        
    } catch (error) {
        console.error('Error verifying OTP:', error);
        document.getElementById('forgotOtpError').textContent = 'Network error. Please try again.';
        document.getElementById('forgotOtpError').style.display = 'block';
    } finally {
        // Restore button state
        const submitBtn = document.querySelector('#forgotOtpForm button[type="submit"]');
        submitBtn.textContent = 'Verify OTP';
        submitBtn.disabled = false;
    }
    // ========== END OF ADDED CODE ==========
}
  async function handleResendOtp(e) {
    e.preventDefault();
    console.log('ðŸ”„ Resend forgot password OTP');
    
    const result = await apiCall('/forgot-password', 'POST', { email: forgotPasswordEmail });
    
    if (result.success && result.data.success) {
      document.getElementById('forgotOtpSuccess').textContent = 'New OTP sent to your email';
      document.getElementById('forgotOtpSuccess').style.display = 'block';
      document.getElementById('forgotOtp').value = '';
    } else {
      alert('Failed to resend OTP. Please try again.');
    }
  }

  async function handleForgotNewPasswordSubmit(e) {
    e.preventDefault();
    console.log('ðŸ”‘ New password submitted');
    
    const newPassword = document.getElementById('forgotNewPassword').value;
    const confirmPassword = document.getElementById('forgotConfirmPassword').value;
    
    document.getElementById('forgotNewPasswordError').style.display = 'none';
    document.getElementById('forgotConfirmPasswordError').style.display = 'none';
    
    let isValid = true;
    
    if (!newPassword) {
      document.getElementById('forgotNewPasswordError').textContent = 'New password is required';
      document.getElementById('forgotNewPasswordError').style.display = 'block';
      isValid = false;
    } else if (!validatePassword(newPassword)) {
      document.getElementById('forgotNewPasswordError').textContent = 'Password must be at least 8 characters with uppercase, lowercase, number, and special character';
      document.getElementById('forgotNewPasswordError').style.display = 'block';
      isValid = false;
    }
    
    if (!confirmPassword) {
      document.getElementById('forgotConfirmPasswordError').textContent = 'Please confirm your password';
      document.getElementById('forgotConfirmPasswordError').style.display = 'block';
      isValid = false;
    } else if (newPassword !== confirmPassword) {
      document.getElementById('forgotConfirmPasswordError').textContent = 'Passwords do not match';
      document.getElementById('forgotConfirmPasswordError').style.display = 'block';
      isValid = false;
    }
    
    if (isValid) {
      // Call backend API
      const result = await apiCall('/reset-password', 'POST', { 
        email: forgotPasswordEmail,
        otp: forgotPasswordOtp,
        newPassword: newPassword
      });
      
      if (result.success && result.data.success) {
        alert('Password reset successfully! You can now login with your new password.');
        resetForgotPasswordFlow();
        document.querySelector('.forgot-password-form').style.display = 'none';
        document.querySelector('.login-form').style.display = 'block';
      } else {
        const errorMsg = result.data?.message || 'Failed to reset password. Please try again.';
        document.getElementById('forgotNewPasswordError').textContent = errorMsg;
        document.getElementById('forgotNewPasswordError').style.display = 'block';
      }
    }
  }

  // ==================== NEW: VERIFY EMAIL FUNCTIONALITY ====================
  
  async function handleVerifyEmailRequestSubmit(e) {
    e.preventDefault();
    console.log('ðŸ“§ Verify email request submitted');
    
    const email = document.getElementById('verifyEmail').value.trim();
    const password = document.getElementById('verifyPassword').value;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    
    document.getElementById('verifyEmailError').style.display = 'none';
    document.getElementById('verifyPasswordError').style.display = 'none';
    
    let isValid = true;
    
    if (!email) {
      document.getElementById('verifyEmailError').textContent = 'Email is required';
      document.getElementById('verifyEmailError').style.display = 'block';
      isValid = false;
    } else if (!emailRegex.test(email)) {
      document.getElementById('verifyEmailError').textContent = 'Please enter a valid email address';
      document.getElementById('verifyEmailError').style.display = 'block';
      isValid = false;
    }
    
    if (!password) {
      document.getElementById('verifyPasswordError').textContent = 'Password is required';
      document.getElementById('verifyPasswordError').style.display = 'block';
      isValid = false;
    }
    
    if (!isValid) return;
    
    try {
      // Show loading state
      const submitBtn = document.querySelector('#verifyEmailRequestForm button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Checking...';
      submitBtn.disabled = true;
      
      // Call backend API to check email verification status
      const result = await apiCall('/check-email-verification', 'POST', { 
        email, 
        password 
      });
      
      console.log('Backend response for email verification:', result);
      
      if (result.success && result.data.success) {
        // Store email for OTP verification
        verifyEmailData = { email };
        
        if (result.data.verified) {
          // Email is already verified
          console.log('âœ… Email already verified');
          showVerifyEmailResult('Already verified.', 'Your email is already verified. You can login to your account.', false);
        } else {
          // Email exists but not verified - send OTP
          console.log('ðŸ“¨ Email not verified, sending OTP');
          
          // Call API to resend OTP
          const otpResult = await apiCall('/resend-verification-otp', 'POST', { email });
          
          if (otpResult.success && otpResult.data.success) {
            // Move to OTP verification step
            showVerifyEmailStep(2);
          } else {
            const errorMsg = otpResult.data?.message || 'Failed to send OTP. Please try again.';
            document.getElementById('verifyEmailError').textContent = errorMsg;
            document.getElementById('verifyEmailError').style.display = 'block';
          }
        }
      } else {
        // Show error message
        const errorMsg = result.data?.message || 'Invalid email or password. Please try again.';
        document.getElementById('verifyEmailError').textContent = errorMsg;
        document.getElementById('verifyEmailError').style.display = 'block';
      }
      
    } catch (error) {
      console.error('âŒ Network error:', error);
      document.getElementById('verifyEmailError').textContent = 'Network error. Please try again.';
      document.getElementById('verifyEmailError').style.display = 'block';
    } finally {
      // Restore button state
      const submitBtn = document.querySelector('#verifyEmailRequestForm button[type="submit"]');
      submitBtn.textContent = 'Verify Account';
      submitBtn.disabled = false;
    }
  }

  async function handleVerifyEmailOtpSubmit(e) {
    e.preventDefault();
    console.log('ðŸ”‘ Verify email OTP submitted');
    
    const otp = document.getElementById('verifyEmailOtp').value.trim();
    
    document.getElementById('verifyEmailOtpError').style.display = 'none';
    document.getElementById('verifyEmailOtpSuccess').style.display = 'none';
    document.getElementById('verifyEmailOtpInfo').style.display = 'none';
    
    if (!otp) {
      document.getElementById('verifyEmailOtpError').textContent = 'OTP is required';
      document.getElementById('verifyEmailOtpError').style.display = 'block';
      return;
    }
    
    if (otp.length !== 6 || !/^\d+$/.test(otp)) {
      document.getElementById('verifyEmailOtpError').textContent = 'Please enter a valid 6-digit OTP';
      document.getElementById('verifyEmailOtpError').style.display = 'block';
      return;
    }
    
    try {
      // Show loading state
      const submitBtn = document.querySelector('#verifyEmailOtpForm button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Verifying...';
      submitBtn.disabled = true;
      
      // Call backend API to verify OTP
      const result = await apiCall('/verify-email-otp', 'POST', { 
        email: verifyEmailData.email, 
        otp: otp 
      });
      
      console.log('Backend response for OTP verification:', result);
      
      if (result.success && result.data.success) {
        // OTP verified successfully
        console.log('âœ… Email verified successfully');
        showVerifyEmailResult('Email Verified Successfully!', 'Your email has been verified successfully. You can now login to your account.', true);
      } else {
        // Show error
        const errorMsg = result.data?.message || 'Invalid OTP. Please try again.';
        document.getElementById('verifyEmailOtpError').textContent = errorMsg;
        document.getElementById('verifyEmailOtpError').style.display = 'block';
      }
      
    } catch (error) {
      console.error('âŒ Network error:', error);
      document.getElementById('verifyEmailOtpError').textContent = 'Network error. Please try again.';
      document.getElementById('verifyEmailOtpError').style.display = 'block';
    } finally {
      // Restore button state
      const submitBtn = document.querySelector('#verifyEmailOtpForm button[type="submit"]');
      submitBtn.textContent = 'Verify OTP';
      submitBtn.disabled = false;
    }
  }

  async function handleResendVerifyEmailOtp(e) {
    e.preventDefault();
    console.log('ðŸ”„ Resend verify email OTP');
    
    // Call API to resend OTP
    const result = await apiCall('/resend-verification-otp', 'POST', { 
      email: verifyEmailData.email 
    });
    
    if (result.success && result.data.success) {
      document.getElementById('verifyEmailOtpSuccess').textContent = 'New OTP sent to your email';
      document.getElementById('verifyEmailOtpSuccess').style.display = 'block';
      document.getElementById('verifyEmailOtp').value = '';
    } else {
      const errorMsg = result.data?.message || 'Failed to resend OTP. Please try again.';
      document.getElementById('verifyEmailOtpError').textContent = errorMsg;
      document.getElementById('verifyEmailOtpError').style.display = 'block';
    }
  }

  function showVerifyEmailResult(message, description, isSuccess) {
    console.log('ðŸ“Š Showing verification result:', message);
    
    // Update result screen based on success status
    const resultIcon = document.getElementById('verifyEmailResultIcon');
    const resultMessage = document.getElementById('verifyEmailResultMessage');
    const resultDescription = document.getElementById('verifyEmailResultDescription');
    
    if (isSuccess) {
      resultIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
      resultIcon.style.color = '#4CAF50';
      resultMessage.textContent = message;
    } else {
      // Already verified case
      resultIcon.innerHTML = '<i class="fas fa-info-circle"></i>';
      resultIcon.style.color = '#6bd2ff';
      resultMessage.textContent = message;
    }
    
    resultDescription.textContent = description;
    
    // Show result step
    showVerifyEmailStep(3);
    
    // Start redirect timer
    startVerifyEmailRedirectTimer();
  }

  function startVerifyEmailRedirectTimer() {
    let timeLeft = 7;
    const timerElement = document.getElementById('verifyEmailRedirectTimer');
    
    const timer = setInterval(() => {
      timerElement.textContent = `Redirecting to login in ${timeLeft} seconds...`;
      timeLeft--;
      
      if (timeLeft < 0) {
        clearInterval(timer);
        resetVerifyEmailFlow();
        document.querySelector('.verify-email-form').style.display = 'none';
        document.querySelector('.login-form').style.display = 'block';
      }
    }, 1000);
  }

  function resetVerifyEmailFlow() {
    console.log('ðŸ”„ Resetting verify email flow');
    
    document.getElementById('verifyEmailRequestForm').reset();
    document.getElementById('verifyEmailOtpForm').reset();
    
    document.querySelectorAll('.verify-email-step').forEach(step => step.style.display = 'none');
    document.getElementById('verifyEmailRequestForm').style.display = 'block';
    
    document.getElementById('verifyEmailStep1').classList.add('active');
    document.getElementById('verifyEmailStep2').classList.remove('active', 'completed');
    document.getElementById('verifyEmailStep3').classList.remove('active', 'completed');
    
    document.querySelectorAll('.error-message, .success-message, .info-message').forEach(msg => {
      msg.style.display = 'none';
    });
    
    verifyEmailData = {};
  }

  function showVerifyEmailStep(stepNumber) {
    console.log(`ðŸ”„ Moving to verify email step: ${stepNumber}`);
    
    document.querySelectorAll('.verify-email-step').forEach(step => step.style.display = 'none');
    
    if (stepNumber === 1) {
      document.getElementById('verifyEmailRequestForm').style.display = 'block';
    } else if (stepNumber === 2) {
      document.getElementById('verifyEmailOtpForm').style.display = 'block';
    } else if (stepNumber === 3) {
      document.getElementById('verifyEmailResultForm').style.display = 'block';
    }
    
    // Update progress steps
    document.querySelectorAll('#verifyEmailStep1, #verifyEmailStep2, #verifyEmailStep3').forEach((step, index) => {
      const stepElement = document.getElementById(`verifyEmailStep${index + 1}`);
      if (index + 1 < stepNumber) {
        stepElement.classList.remove('active');
        stepElement.classList.add('completed');
      } else if (index + 1 === stepNumber) {
        stepElement.classList.add('active');
        stepElement.classList.remove('completed');
      } else {
        stepElement.classList.remove('active', 'completed');
      }
    });
  }

  // ==================== FLOW MANAGEMENT ====================
  
  function initializeEventListeners() {
    console.log('ðŸ”§ Initializing event listeners...');
    
    // Safe event listener function
    function safeAddListener(id, event, handler) {
      const element = document.getElementById(id);
      if (element) {
        element.addEventListener(event, handler);
        console.log(`âœ… Added ${event} listener to #${id}`);
        return true;
      } else {
        console.log(`âŒ Element #${id} not found - skipping`);
        return false;
      }
    }

    // ========== FORM NAVIGATION ==========
    
    // Switch to Signup form
    safeAddListener('showSignup', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Switching to signup form');
      document.querySelector('.login-form').style.display = 'none';
      document.querySelector('.signup-form').style.display = 'block';
      document.querySelector('.forgot-password-form').style.display = 'none';
      document.querySelector('.verify-email-form').style.display = 'none';
      resetSignupFlow();
    });

    // Switch to Login from other pages
    safeAddListener('showLoginFromSignup', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Switching to login form from signup');
      document.querySelector('.signup-form').style.display = 'none';
      document.querySelector('.login-form').style.display = 'block';
      document.querySelector('.forgot-password-form').style.display = 'none';
      document.querySelector('.verify-email-form').style.display = 'none';
    });

    safeAddListener('showForgotPassword', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Switching to forgot password form');
      document.querySelector('.login-form').style.display = 'none';
      document.querySelector('.signup-form').style.display = 'none';
      document.querySelector('.forgot-password-form').style.display = 'block';
      document.querySelector('.verify-email-form').style.display = 'none';
      resetForgotPasswordFlow();
    });

    // NEW: Switch to Verify Email form
    safeAddListener('showVerifyEmail', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Switching to verify email form');
      document.querySelector('.login-form').style.display = 'none';
      document.querySelector('.signup-form').style.display = 'none';
      document.querySelector('.forgot-password-form').style.display = 'none';
      document.querySelector('.verify-email-form').style.display = 'block';
      resetVerifyEmailFlow();
    });

    safeAddListener('backToLoginFromForgot', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Switching back to login from forgot password');
      document.querySelector('.forgot-password-form').style.display = 'none';
      document.querySelector('.login-form').style.display = 'block';
    });

    // NEW: Back to Login from Verify Email
    safeAddListener('backToLoginFromVerify', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Switching back to login from verify email');
      document.querySelector('.verify-email-form').style.display = 'none';
      document.querySelector('.login-form').style.display = 'block';
    });

    // ========== FORM SUBMISSIONS ==========
    
    // CRITICAL: Make sure these are connected
    const signupConnected = safeAddListener('signupDetailsForm', 'submit', handleSignupDetailsSubmit);
    const otpConnected = safeAddListener('signupOtpForm', 'submit', handleSignupOtpSubmit);
    const loginConnected = safeAddListener('loginForm', 'submit', handleLoginSubmit);
    
    // NEW: Verify Email form submissions
    const verifyEmailRequestConnected = safeAddListener('verifyEmailRequestForm', 'submit', handleVerifyEmailRequestSubmit);
    const verifyEmailOtpConnected = safeAddListener('verifyEmailOtpForm', 'submit', handleVerifyEmailOtpSubmit);
    
    console.log('ðŸ“Š Form connection summary:');
    console.log('  - Signup form:', signupConnected ? 'âœ… CONNECTED' : 'âŒ MISSING');
    console.log('  - OTP form:', otpConnected ? 'âœ… CONNECTED' : 'âŒ MISSING'); 
    console.log('  - Login form:', loginConnected ? 'âœ… CONNECTED' : 'âŒ MISSING');
    console.log('  - Verify Email Request form:', verifyEmailRequestConnected ? 'âœ… CONNECTED' : 'âŒ MISSING');
    console.log('  - Verify Email OTP form:', verifyEmailOtpConnected ? 'âœ… CONNECTED' : 'âŒ MISSING');

    // Optional buttons
    safeAddListener('resendSignupOtp', 'click', handleResendSignupOtp);
    safeAddListener('backToSignupDetails', 'click', handleBackToSignupDetails);
    
    safeAddListener('forgotEmailForm', 'submit', handleForgotEmailSubmit);
    safeAddListener('forgotOtpForm', 'submit', handleForgotOtpSubmit);
    safeAddListener('resendOtp', 'click', handleResendOtp);
    safeAddListener('backToEmailStep', 'click', handleBackToEmailStep);
    safeAddListener('backToOtpStep', 'click', handleBackToOtpStep);
    safeAddListener('forgotNewPasswordForm', 'submit', handleForgotNewPasswordSubmit);
    
    // NEW: Verify Email buttons
    safeAddListener('resendVerifyEmailOtp', 'click', handleResendVerifyEmailOtp);
    safeAddListener('backToVerifyEmailRequest', 'click', function(e) {
      e.preventDefault();
      console.log('ðŸ”„ Back to verify email request');
      showVerifyEmailStep(1);
    });

    console.log('âœ… Event listener initialization completed');
  }

  function resetSignupFlow() {
    console.log('ðŸ”„ Resetting signup flow');
    document.getElementById('signupDetailsForm').reset();
    document.getElementById('signupOtpForm').reset();
    
    document.querySelectorAll('.signup-step').forEach(step => step.style.display = 'none');
    document.getElementById('signupDetailsForm').style.display = 'block';
    
    document.getElementById('signupStep1').classList.add('active');
    document.getElementById('signupStep1').classList.remove('completed');
    document.getElementById('signupStep2').classList.remove('active', 'completed');
    document.getElementById('signupStep3').classList.remove('active', 'completed');
    
    document.querySelectorAll('.error-message, .success-message, .cooldown-message').forEach(msg => {
      msg.style.display = 'none';
    });
    
    document.getElementById('passwordStrengthBar').style.width = '0%';
    document.getElementById('passwordStrengthBar').className = 'password-strength-bar';
    
    signupOtpAttempts = 0;
    signupCooldownActive = false;
    const resendBtn = document.getElementById('resendSignupOtp');
    if (resendBtn) resendBtn.classList.remove('disabled');
    
    if (redirectTimer) clearInterval(redirectTimer);
    signupData = {};
  }

  function showSignupStep(stepNumber) {
    console.log(`ðŸ”„ Moving to signup step: ${stepNumber}`);
    
    document.querySelectorAll('.signup-step').forEach(step => step.style.display = 'none');
    
    if (stepNumber === 1) {
      document.getElementById('signupDetailsForm').style.display = 'block';
    } else if (stepNumber === 2) {
      document.getElementById('signupOtpForm').style.display = 'block';
    } else if (stepNumber === 3) {
      document.getElementById('signupSuccessForm').style.display = 'block';
      startRedirectTimer();
    }
    
    document.querySelectorAll('#signupStep1, #signupStep2, #signupStep3').forEach((step, index) => {
      const stepElement = document.getElementById(`signupStep${index + 1}`);
      if (index + 1 < stepNumber) {
        stepElement.classList.remove('active');
        stepElement.classList.add('completed');
      } else if (index + 1 === stepNumber) {
        stepElement.classList.add('active');
        stepElement.classList.remove('completed');
      } else {
        stepElement.classList.remove('active', 'completed');
      }
    });
  }

  function startRedirectTimer() {
    let timeLeft = 7;
    const timerElement = document.getElementById('redirectTimer');
    
    redirectTimer = setInterval(() => {
      timerElement.textContent = `Redirecting in ${timeLeft} seconds...`;
      timeLeft--;
      
      if (timeLeft < 0) {
        clearInterval(redirectTimer);
        resetSignupFlow();
        document.querySelector('.signup-form').style.display = 'none';
        document.querySelector('.login-form').style.display = 'block';
      }
    }, 1000);
  }

  function checkOtpAttempts() {
    if (signupOtpAttempts >= 3) {
      signupCooldownActive = true;
      document.getElementById('signupOtpCooldown').textContent = `Too many failed attempts. Please wait ${signupCooldownTime} seconds before trying again.`;
      document.getElementById('signupOtpCooldown').style.display = 'block';
      document.getElementById('resendSignupOtp').classList.add('disabled');
      
      let cooldownCounter = signupCooldownTime;
      const cooldownInterval = setInterval(() => {
        cooldownCounter--;
        document.getElementById('signupOtpCooldown').textContent = `Too many failed attempts. Please wait ${cooldownCounter} seconds before trying again.`;
        
        if (cooldownCounter <= 0) {
          clearInterval(cooldownInterval);
          signupCooldownActive = false;
          signupOtpAttempts = 0;
          document.getElementById('signupOtpCooldown').style.display = 'none';
          document.getElementById('resendSignupOtp').classList.remove('disabled');
        }
      }, 1000);
    }
  }

  function handleBackToSignupDetails(e) {
    e.preventDefault();
    console.log('ðŸ”„ Back to signup details');
    showSignupStep(1);
  }

  function resetForgotPasswordFlow() {
    console.log('ðŸ”„ Resetting forgot password flow');
    document.getElementById('forgotEmailForm').reset();
    document.getElementById('forgotOtpForm').reset();
    document.getElementById('forgotNewPasswordForm').reset();
    
    document.querySelectorAll('.forgot-step').forEach(step => step.style.display = 'none');
    document.getElementById('forgotEmailForm').style.display = 'block';
    
    document.getElementById('forgotStep1').classList.add('active');
    document.getElementById('forgotStep2').classList.remove('active');
    document.getElementById('forgotStep3').classList.remove('active');
    
    document.querySelectorAll('.error-message, .success-message').forEach(msg => {
      msg.style.display = 'none';
    });
    
    document.getElementById('forgotPasswordStrengthBar').style.width = '0%';
    document.getElementById('forgotPasswordStrengthBar').className = 'password-strength-bar';
    
    forgotPasswordEmail = '';
    forgotPasswordOtp = '';
  }

  function showForgotStep(stepNumber) {
    console.log(`ðŸ”„ Moving to forgot password step: ${stepNumber}`);
    
    document.querySelectorAll('.forgot-step').forEach(step => step.style.display = 'none');
    
    if (stepNumber === 1) {
      document.getElementById('forgotEmailForm').style.display = 'block';
    } else if (stepNumber === 2) {
      document.getElementById('forgotOtpForm').style.display = 'block';
    } else if (stepNumber === 3) {
      document.getElementById('forgotNewPasswordForm').style.display = 'block';
    }
    
    document.querySelectorAll('#forgotStep1, #forgotStep2, #forgotStep3').forEach((step, index) => {
      if (index < stepNumber) {
        step.classList.add('active');
      } else {
        step.classList.remove('active');
      }
    });
  }

  function handleBackToEmailStep(e) {
    e.preventDefault();
    console.log('ðŸ”„ Back to email step');
    showForgotStep(1);
  }

  function handleBackToOtpStep(e) {
    e.preventDefault();
    console.log('ðŸ”„ Back to OTP step');
    showForgotStep(2);
  }

  // ==================== INITIALIZATION ====================

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ DOM fully loaded');
    
    // Populate country codes dropdown
    populateCountryCodes();
    
    // Test form connections immediately
    const signupForm = document.getElementById('signupDetailsForm');
    const loginForm = document.getElementById('loginForm');
    const verifyEmailForm = document.getElementById('verifyEmailRequestForm');
    
    console.log('ðŸ“ Signup form found:', !!signupForm);
    console.log('ðŸ“ Login form found:', !!loginForm);
    console.log('ðŸ“ Verify Email form found:', !!verifyEmailForm);
    
    if (signupForm) {
      signupForm.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('ðŸŽ¯ SIGNUP FORM SUBMITTED! This should happen when clicking Send OTP');
      });
    }
    
    if (verifyEmailForm) {
      verifyEmailForm.addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('ðŸŽ¯ VERIFY EMAIL FORM SUBMITTED! This should happen when clicking Verify Account');
      });
    }
    
    // Initialize all event listeners
    initializeEventListeners();
    
    // Check if user is already logged in
    const token = localStorage.getItem('token');
    if (token) {
      console.log('ðŸ” User is already logged in');
    }
  });
</script>
</body>
</html>